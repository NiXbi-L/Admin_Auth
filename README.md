# Микросервис аутентификации с JWT

REST API на Django для аутентификации с использованием JWT токенов и верификации по электронной почте.

## Особенности

- Регистрация пользователей с подтверждением электронной почты
- Аутентификация на основе JWT токенов
- Система верификации через код, отправляемый на email
- Конфигурация из переменных окружения
- Поддержка PostgreSQL
- Настройка CORS для безопасного взаимодействия с фронтендом

## API Endpoints

### Аутентификация

#### Регистрация нового пользователя

- **URL**: `/api/auth/register/`
- **Метод**: `POST`
- **Данные запроса**:
  ```json
  {
    "username": "пользователь",
    "email": "user@example.com",
    "password": "пароль123"
  }
  ```
- **Ответ**:
  ```json
  {
    "user": {
      "id": 1,
      "username": "пользователь",
      "email": "user@example.com",
      "is_email_verified": false
    },
    "message": "Пользователь успешно создан. Проверьте вашу электронную почту для получения кода подтверждения."
  }
  ```

#### Подтверждение электронной почты

- **URL**: `/api/auth/verify-email/`
- **Метод**: `POST`
- **Данные запроса**:
  ```json
  {
    "email": "user@example.com",
    "verification_code": "123456"
  }
  ```
- **Ответ**:
  ```json
  {
    "user": {
      "id": 1,
      "username": "пользователь",
      "email": "user@example.com",
      "is_email_verified": true
    },
    "refresh": "refresh_token",
    "access": "access_token",
    "message": "Email успешно подтвержден."
  }
  ```

#### Повторная отправка кода подтверждения

- **URL**: `/api/auth/resend-verification/`
- **Метод**: `POST`
- **Данные запроса**:
  ```json
  {
    "email": "user@example.com"
  }
  ```
- **Ответ**:
  ```json
  {
    "message": "Код подтверждения отправлен повторно. Проверьте вашу электронную почту."
  }
  ```

#### Вход в систему

- **URL**: `/api/auth/login/`
- **Метод**: `POST`
- **Данные запроса**:
  ```json
  {
    "email": "user@example.com",
    "password": "пароль123"
  }
  ```
- **Ответ**:
  ```json
  {
    "user": {
      "id": 1,
      "username": "пользователь",
      "email": "user@example.com",
      "is_email_verified": true
    },
    "refresh": "refresh_token",
    "access": "access_token"
  }
  ```

#### Обновление токена

- **URL**: `/api/auth/token/refresh/`
- **Метод**: `POST`
- **Данные запроса**:
  ```json
  {
    "refresh": "refresh_token"
  }
  ```
- **Ответ**:
  ```json
  {
    "access": "new_access_token"
  }
  ```

#### Получение данных пользователя

- **URL**: `/api/auth/user/`
- **Метод**: `GET`
- **Заголовки**:
  ```
  Authorization: Bearer access_token
  ```
- **Ответ**:
  ```json
  {
    "id": 1,
    "username": "пользователь",
    "email": "user@example.com",
    "is_email_verified": true
  }
  ```

## Процесс верификации по электронной почте

1. Пользователь регистрируется с указанием email и пароля
2. Система генерирует 6-значный код и отправляет его на указанный email
3. Пользователь вводит полученный код в системе
4. После успешной проверки кода аккаунт активируется и генерируются JWT токены

## Переменные окружения

Приложение полностью настраивается через переменные окружения. Используйте файл `.env` для их задания.

### Основные настройки

| Переменная      | Описание                         | Значение по умолчанию                                              |
|-----------------|----------------------------------|--------------------------------------------------------------------|
| `SECRET_KEY`    | Секретный ключ Django            | django-insecure-g1nu3!66#&p=sslk32ui9_s%ad4$c0a=#sn%752yq5+n^b9d(% |
| `DEBUG`         | Режим отладки                    | True                                                               |
| `ALLOWED_HOSTS` | Разрешенные хосты, через запятую | 127.0.0.1,localhost                                                |

### База данных PostgreSQL

| Переменная    | Описание                     | Значение по умолчанию |
|---------------|------------------------------|-----------------------|
| `DB_NAME`     | Имя базы данных              | auth_db               |
| `DB_USER`     | Имя пользователя базы данных | postgres              |
| `DB_PASSWORD` | Пароль к базе данных         | -                     |
| `DB_HOST`     | Хост базы данных             | localhost             |
| `DB_PORT`     | Порт базы данных             | 5432                  |

### Настройки CORS

| Переменная               | Описание                               | Значение по умолчанию                       |
|--------------------------|----------------------------------------|---------------------------------------------|
| `CORS_ALLOWED_ORIGINS`   | Разрешенные источники, через запятую   | http://localhost:3000,http://127.0.0.1:3000 |
| `CORS_ALLOW_ALL_ORIGINS` | Разрешить все источники                | False                                       |
| `CORS_ALLOW_CREDENTIALS` | Разрешить отправку учетных данных      | True                                        |
| `CORS_ALLOW_METHODS`     | Разрешенные HTTP-методы, через запятую | GET,POST,PUT,PATCH,DELETE,OPTIONS           |

### Настройки JWT

| Переменная                     | Описание                                             | Значение по умолчанию |
|--------------------------------|------------------------------------------------------|-----------------------|
| `JWT_ACCESS_TOKEN_LIFETIME`    | Срок действия access токена (в минутах)              | 60                    |
| `JWT_REFRESH_TOKEN_LIFETIME`   | Срок действия refresh токена (в днях)                | 1                     |
| `JWT_ROTATE_REFRESH_TOKENS`    | Обновлять refresh токен при обновлении access токена | False                 |
| `JWT_BLACKLIST_AFTER_ROTATION` | Помещать старые refresh токены в черный список       | True                  |
| `JWT_UPDATE_LAST_LOGIN`        | Обновлять время последнего входа пользователя        | False                 |
| `JWT_ALGORITHM`                | Алгоритм шифрования                                  | HS256                 |
| `JWT_AUTH_HEADER_TYPE`         | Тип заголовка авторизации                            | Bearer                |

### Настройки электронной почты

| Переменная            | Описание                              | Значение по умолчанию |
|-----------------------|---------------------------------------|-----------------------|
| `EMAIL_HOST`          | SMTP сервер                           | smtp.gmail.com        |
| `EMAIL_PORT`          | Порт SMTP сервера                     | 587                   |
| `EMAIL_USE_TLS`       | Использовать TLS                      | True                  |
| `EMAIL_HOST_USER`     | Адрес отправителя                     | -                     |
| `EMAIL_HOST_PASSWORD` | Пароль от почты или пароль приложения | -                     |

### Настройки суперпользователя (для Docker)

| Переменная                  | Описание                 | Значение по умолчанию |
|-----------------------------|--------------------------|-----------------------|
| `DJANGO_SUPERUSER_USERNAME` | Имя суперпользователя    | admin                 |
| `DJANGO_SUPERUSER_EMAIL`    | Email суперпользователя  | admin@example.com     |
| `DJANGO_SUPERUSER_PASSWORD` | Пароль суперпользователя | admin                 | 